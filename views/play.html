{{ define "play" }}
<!--  -->
{{ template "layoutheader" . }}

<style>
  .sidebar {
    /* height: 90vh; */
    height: 100%;
    width: 250px;
    position: absolute;
    /* top: 40px; */
    left: 0;
    background-color: #f8f9fa;
    padding: 15px;
  }
  main {
    margin-left: 250px;
  }
  .player-info {
    margin-bottom: 20px;
  }
  .list-group-item {
    border: none;
  }
</style>

{{ template "client-list" . }}
<!--  -->
{{ block "game-status" .Game }}
<p id="gameStatus" hx-swap-oob="true">{{ .PlayStatus }}</p>
{{ end }}
<!--  -->
{{ template "live-board" .Game }}
<!--  -->
{{if .Game.GameOver }} {{ template "history-controls" .Game }} {{end}}
<!--  -->
{{ template "layoutfooter" . }}
<!-- <div hx-post="/games/{{.Game.Id}}/connected" hx-trigger="every 1s"></div> -->
{{ end }}

<!--  -->

{{ define "board" }}
<!--  -->
{{ range $cell := Cells .}}
<!--  -->
{{ block "cell" . }}
<div
  class="tic-tac-toe-cell"
  data-cell
  hx-post="/move?i={{ .Index }}&id={{ .GameId }}"
  hx-swap="outerHTML"
>
  {{ .Symbol }}
</div>
{{ end }}
<!--  -->
{{ end }}
<!--  -->
{{ end }}

<!--  -->

{{ define "live-board" }}
<div
  hx-ext="sse"
  sse-connect="/liveboard/{{.Id}}"
  sse-swap="game_refresh_{{.Id}}"
  class="tic-tac-toe-board"
  sse-close="game_over"
>
  {{ range $cell := Cells .}}
  <!--  -->
  {{ template "cell" . }}
  <!--  -->
  {{ end }}
</div>
{{ end }}

<!--  -->

{{ define "client-list" }}
<aside hx-swap-oob="true" id="client-list" hx class="sidebar">
  <h3>Players</h3>
  <div class="player-info">
    <h5
      class="{{if eq .Game.CurrentPlayer.Name .Game.Player1.Name}}fw-bold{{end}}"
    >
      Player 1 {{ if eq .Game.Player1.Name .ClientId }} (You) {{end}}
    </h5>
    <p>Client Id: {{.Game.Player1.Name}}</p>
  </div>
  <div class="player-info">
    {{if .Game.Player2}}
    <h5
      class="{{if eq .Game.CurrentPlayer.Name .Game.Player2.Name}}fw-bold{{end}}"
    >
      Player 2 {{ if eq .Game.Player2.Name .ClientId }} (You) {{end}}
    </h5>
    <p>Client Id: {{.Game.Player2.Name}}</p>
    {{else}}
    <span>Waiting for player 2...</span>
    {{end}}
  </div>
  <div>
    <h4>Spectators</h4>
    <ul class="list-group">
      {{ $clientId := .ClientId }}
      <!--  -->
      {{ range $spec := Spectators .Game }}
      <li
        class="list-group-item"
        style="font-size: 0.8rem;color: {{if $spec.Connected}}green{{else}}red{{end}};"
      >
        {{ $spec.Name }} {{ if eq $spec.Name $clientId }}(You){{end}}
      </li>
      {{ end }}
    </ul>
  </div>
</aside>
{{ end }}

<!--  -->

{{ define "history-controls" }}
<div id="history-controls" hx-swap-oob="true">hello</div>
{{ end }}
